# Alerting rules for Peakees application
groups:
  - name: peakees-alerts
    rules:
      # Application availability
      - alert: PeakeesAppDown
        expr: up{job="peakees-app"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Peakees application is down"
          description: "Peakees application has been down for more than 1 minute."
          
      - alert: PeakeesHighResponseTime
        expr: peakees_api_response_time_ms > 5000
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Peakees high response time"
          description: "Peakees API response time is {{ $value }}ms, above the 5s threshold."
          
      - alert: PeakeesDatabaseDown
        expr: peakees_database_connection_status == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Peakees database connection is down"
          description: "Peakees cannot connect to the database."
          
      - alert: PeakeesDatabaseSlowResponse
        expr: peakees_database_response_time_ms > 2000
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Peakees database slow response"
          description: "Database response time is {{ $value }}ms, above the 2s threshold."

  - name: system-alerts
    rules:
      # Memory usage
      - alert: HighMemoryUsage
        expr: (nodejs_memory_heap_used_bytes / nodejs_memory_heap_total_bytes) * 100 > 90
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is above 90% for more than 5 minutes."
          
      - alert: CriticalMemoryUsage
        expr: (nodejs_memory_heap_used_bytes / nodejs_memory_heap_total_bytes) * 100 > 95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Critical memory usage detected"
          description: "Memory usage is above 95% for more than 2 minutes."

  - name: business-alerts
    rules:
      # Website availability
      - alert: WebsiteDown
        expr: probe_success{instance="https://peakees.vercel.app"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Website is down"
          description: "The main website is not accessible."
          
      - alert: HealthCheckFailing
        expr: probe_success{instance="https://peakees.vercel.app/api/health"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Health check is failing"
          description: "The health check endpoint is not responding."
          
      - alert: WebsiteSlowResponse
        expr: probe_duration_seconds{instance="https://peakees.vercel.app"} > 3
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Website slow response"
          description: "Website response time is {{ $value }}s, above the 3s threshold."